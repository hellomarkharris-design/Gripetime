<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Gripetime</title>

<!-- Poppins ExtraBold -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;}
html,body{margin:0;padding:0;}
body{
  font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  font-weight:800;
  background:#0b0d26;
  color:#fff;
}

/* Theme colors */
:root{
  --purple:#7c3aed;
  --neon:#39ff14;
  --ink:#ffffff;
  --bg:#0b0d26;
  --card:#10142f;
  --ring:#14183b;
  --soft:#1b2047;
  --border:#232a5b;
}

/* Header */
header{padding:12px 16px;background:#0b0d26;position:sticky;top:0;z-index:10;}
nav a{
  margin-right:16px;
  color:var(--ink);
  text-decoration:none;
  font-weight:800;
}
nav a.active{color:var(--neon);}
.wrap{max-width:1100px;margin:0 auto;padding:20px;}
.center{text-align:center;}

/* Buttons */
.btn{
  background:var(--purple);
  color:var(--ink);
  border:0;
  border-radius:12px;
  padding:12px 22px;
  font-weight:800;
  cursor:pointer;
}
.btn.neon{background:var(--neon);color:#0b0d26;}
.btn.secondary{background:#2c3368;color:#fff;border:1px solid #3b4594;}

/* Sections & cards */
section{margin-bottom:40px;}
.card{background:var(--soft);border:1px solid var(--border);border-radius:16px;padding:18px;margin-top:16px;}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
@media(max-width:900px){.grid2{grid-template-columns:1fr;}}

/* HEAD TO HEAD Title */
.title{
  font-size:26px;
  text-align:center;
  font-weight:800;
  letter-spacing:2px;
}
.title span{color:var(--neon);}
.divider{height:4px;background:var(--neon);width:38%;margin:10px auto;}

/* UFC Fighter Names */
.cornerName{
  text-align:center;
  font-size:22px;
  margin-bottom:6px;
}
.cornerName.red{color:var(--purple);}
.cornerName.blue{color:var(--neon);}

/* VS Badge */
.vs{
  width:75px;height:75px;
  border-radius:50%;
  border:3px solid var(--neon);
  display:grid;place-items:center;
  background:#111;color:var(--neon);
  font-size:34px;
  margin:0 auto;
  position:relative;
  animation:vsFlash 3s ease-in-out infinite;
}
.vs::after{
  content:"";
  position:absolute;
  inset:-14px;
  border-radius:50%;
  opacity:0;
  box-shadow:
    0 0 60px 16px rgba(57,255,20,0.45),
    0 0 120px 28px rgba(124,58,237,0.30);
  animation:vsHalo 3s ease-in-out infinite;
}

/* VS Animations */
@keyframes vsFlash{
  0%,100% { transform:scale(1); }
  10%     { transform:scale(1.14); }
  14%     { transform:scale(1); }
  50%     { transform:scale(1.06); }
}
@keyframes vsHalo{
  0%,100%{opacity:0;}
  8%{opacity:1;}
  20%{opacity:0;}
}

/* Fighter Layout */
.ring{
  display:grid;
  grid-template-columns:1fr 80px 1fr;
  gap:16px;
  align-items:start;
  margin-top:10px;
  scale:0.83;
  transform-origin:top center;
}

.photoCircle{
  width:200px;height:200px;
  border-radius:50%;
  border:4px solid var(--purple);
  display:grid;place-items:center;
  background:#0f1333;
  color:var(--neon);
  margin:0 auto;
  position:relative;
}

/* Glow over fighters */
#homeLeftCircle{
  animation:leftPulse 2.4s ease-in-out infinite;
}
#homeRightCircle{
  animation:rightPulse 2.4s ease-in-out infinite;
  animation-delay:.4s;
}
@keyframes leftPulse{
  0%{box-shadow:0 0 0 0 rgba(124,58,237,0);}
  50%{box-shadow:
    0 0 32px 8px rgba(124,58,237,0.6),
    0 0 80px 20px rgba(124,58,237,0.3);
  }
  100%{box-shadow:0 0 0 0 rgba(124,58,237,0);}
}
@keyframes rightPulse{
  0%{box-shadow:0 0 0 0 rgba(57,255,20,0);}
  50%{box-shadow:
    0 0 32px 8px rgba(57,255,20,0.6),
    0 0 80px 20px rgba(57,255,20,0.3);
  }
  100%{box-shadow:0 0 0 0 rgba(57,255,20,0);}
}

.mainPhoto{
  height:200px;border-radius:12px;
  border:2px dashed var(--purple);
  display:grid;place-items:center;
  color:var(--neon);margin-top:6px;
}
.thumb{
  height:90px;border-radius:10px;
  border:2px dashed var(--purple);
  display:grid;place-items:center;color:var(--neon);
}
.thumbs{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px;}

/* Text areas */
textarea,input{width:100%;padding:10px;border-radius:8px;background:#121741;color:#fff;border:1px solid #232a5b;font-weight:800;}

/* Vote stars */
.voteRow{display:flex;justify-content:center;margin-top:10px;}
.stars{display:flex;gap:6px;margin-right:10px;}
.stars button{
  background:#101542;border:1px solid #5a66d6;
  padding:6px 8px;border-radius:8px;
  color:var(--neon);cursor:pointer;font-weight:800;
}

/* Upload areas */
.drop{
  border:2px dashed var(--purple);
  border-radius:14px;
  height:160px;display:grid;place-items:center;
  background:#0f1333;color:var(--neon);cursor:pointer;
}
.drop.drag{background:#161d4a;}
textarea,input,select{font-weight:800;border-radius:12px;}

/* Age badges */
.age-green{background:#10351c;border:1px solid #1f6b39;}
.age-yellow{background:#3b370f;border:1px solid #7a7420;}
.age-red{background:#41141b;border:1px solid #9c2c3f;}
</style>
</head>

<body>
<header class="wrap">
  <nav>
    <a href="#/" data-route>Home</a>
    <a href="#/create" data-route>Create a Gripe</a>
    <a href="#/respond" data-route>Respond</a>
    <a href="#/gripes" data-route>Gripes</a>
    <a href="#/rules" data-route>Rules</a>
    <a href="#/legal" data-route>Legal</a>
  </nav>
</header>

<main class="wrap">

<!-- ✅ HOME -->
<section id="home">
  <div class="center">
    <img src="logo.png" style="height:168px"/>
  </div>

  <div class="card">
    <div class="title">HEAD <span>TO</span> HEAD</div>
    <div class="divider"></div>

    <select id="homeSelect" style="width:100%;padding:12px;margin-bottom:12px;"></select>

    <div class="ring">
      <!-- Left -->
      <div class="card" id="homeLeft">
        <div class="cornerName red">GRIPER</div>
        <div class="photoCircle" id="homeLeftCircle">PHOTO</div>
        <div class="mainPhoto" id="homeLeftMain">Main Image</div>
        <div class="thumbs">
          <div class="thumb" id="homeLeftT2">Photo 2</div>
          <div class="thumb" id="homeLeftT3">Photo 3</div>
        </div><br>
        <textarea id="homeLeftText" readonly style="min-height:120px"></textarea>
        <div class="voteRow">
          <div class="stars" id="starsL"></div>
          <button class="btn" id="voteL">VOTE</button>
        </div>
      </div>

      <!-- VS -->
      <div class="vs">VS</div>

      <!-- Right -->
      <div class="card" id="homeRight">
        <div class="cornerName blue">GRIPEE</div>
        <div class="photoCircle" id="homeRightCircle">PHOTO</div>
        <div class="mainPhoto" id="homeRightMain">Main Image</div>
        <div class="thumbs">
          <div class="thumb" id="homeRightT2">Photo 2</div>
          <div class="thumb" id="homeRightT3">Photo 3</div>
        </div><br>
        <textarea id="homeRightText" readonly style="min-height:120px"></textarea>
        <div class="voteRow">
          <div class="stars" id="starsR"></div>
          <button class="btn neon" id="voteR">VOTE</button>
        </div>
      </div>
    </div>

    <div style="text-align:center;margin-top:12px;">
      Griper: <span id="countL">0</span> |
      Gripee: <span id="countR">0</span>
    </div>
  </div>
</section>

<!-- ✅ CREATE -->
<section id="create" hidden class="card">
  <h2>Create a Gripe</h2>

  <div class="grid2">
    <div>
      <div class="drop" id="createDrop">Click or drop images</div>
      <input id="createFiles" type="file" accept="image/*" multiple hidden/>
      <div id="createCount">0 / 3 selected</div>
    </div>

    <div>
      <textarea id="createText" rows="10" placeholder="Describe your gripe..."></textarea>
      <div id="createWords">0 / 1000 words</div>
    </div>
  </div>

  <button class="btn" id="saveDraft">Save Draft</button>
</section>

<!-- ✅ RESPOND -->
<section id="respond" hidden class="card">
  <h2>Respond to a Gripe</h2>

  <select id="respSelect" style="width:100%;padding:10px;"></select>

  <div class="grid2" style="margin-top:10px;">
    <div>
      <div class="drop" id="respDrop">Click or drop images</div>
      <input id="respFiles" type="file" accept="image/*" multiple hidden/>
      <div id="respCount">0 / 3 selected</div>
    </div>

    <div>
      <textarea id="respText" rows="10" placeholder="Respond here..."></textarea>
      <div id="respWords">0 / 1000 words</div>
    </div>
  </div>

  <button class="btn" id="saveResponse">Save Response</button>
</section>

<!-- ✅ GRIPES -->
<section id="gripes" hidden>
  <h2>All Gripes</h2>
  <ul id="gripesList" style="list-style:none;padding:0;"></ul>
</section>

<section id="rules" hidden class="card">
  <h2>Rules</h2>
  Be civil. No doxxing or hate speech.
</section>

<section id="legal" hidden class="card">
  <h2>Legal</h2>
  Gripetime is for entertainment only, not legal advice.
</section>
</main>

<script>
/* ===== CLIENT STORAGE ===== */
const LS_KEY="gt_v3";
function load(){return JSON.parse(localStorage.getItem(LS_KEY)||`{"gripes":[],"selectedId":null}`);}
function save(db){localStorage.setItem(LS_KEY,JSON.stringify(db));}
const browserId=localStorage.gtBrowserId||(localStorage.gtBrowserId=Math.random().toString(36).slice(2));

/* ===== ROUTING ===== */
const pages=["home","create","respond","gripes","rules","legal"];
function show(id){
  pages.forEach(p=>document.getElementById(p).hidden=p!==id);
  document.querySelectorAll("nav a").forEach(a=>a.classList.toggle("active",a.getAttribute("href")==="#/"+id));
}
function go(h){location.hash=h;}
if(!location.hash)go("#/");
addEventListener("hashchange",()=>{
  const page=location.hash.replace("#/","")||"home";
  show(page);
  if(page==="home") renderHome();
  if(page==="gripes") renderList();
  if(page==="respond") fillRespondSelect();
});

/* ===== HELPERS ===== */
const wc=s=>s.trim()?.split(/\s+/).length||0;
const clip=s=>wc(s)>1000?s.split(/\s+/).slice(0,1000).join(" "):s;
function dt(file){return new Promise(r=>{const fr=new FileReader();fr.onload=e=>r(e.target.result);fr.readAsDataURL(file);});}

/* ===== CREATE ===== */
const cDrop=document.getElementById("createDrop");
const cFiles=document.getElementById("createFiles");
const cCount=document.getElementById("createCount");
const cText=document.getElementById("createText");
const cWords=document.getElementById("createWords");

cDrop.onclick=()=>cFiles.click();
["dragover","drop"].forEach(ev=>cDrop.addEventListener(ev,e=>e.preventDefault()));
cDrop.addEventListener("drop",e=>{
  cFiles.files=e.dataTransfer.files;
  cCount.textContent=`${Math.min(3,cFiles.files.length)} / 3 selected`;
});
cFiles.onchange=()=>cCount.textContent=`${Math.min(3,cFiles.files.length)} / 3 selected`;
cText.oninput=()=>{cText.value=clip(cText.value);cWords.textContent=`${wc(cText.value)} / 1000 words`;};

document.getElementById("saveDraft").onclick=async ()=>{
  const db=load();
  const imgs=await Promise.all([...cFiles.files].slice(0,3).map(dt));
  const id="g"+Math.random().toString(36).slice(2);
  db.gripes.unshift({id,status:"Active",created:Date.now(),votes:{L:0,R:0},voted:{},griper:{images:imgs,text:cText.value},gripee:{images:[],text:""}});
  db.selectedId=id; save(db);
  cFiles.value="";cText.value="";cWords.textContent="0/1000";cCount.textContent="0/3";
  go("#/");
};

/* ===== RESPOND ===== */
const rDrop=document.getElementById("respDrop");
const rFiles=document.getElementById("respFiles");
const rCount=document.getElementById("respCount");
const rText=document.getElementById("respText");
const rWords=document.getElementById("respWords");
rDrop.onclick=()=>rFiles.click();
["dragover","drop"].forEach(ev=>rDrop.addEventListener(ev,e=>e.preventDefault()));
rDrop.addEventListener("drop",e=>{
  rFiles.files=e.dataTransfer.files;
  rCount.textContent=`${Math.min(3,rFiles.files.length)} / 3 selected`;
});
rFiles.onchange=()=>rCount.textContent=`${Math.min(3,rFiles.files.length)} / 3 selected`;
rText.oninput=()=>{rText.value=clip(rText.value);rWords.textContent=`${wc(rText.value)} / 1000 words`;};

document.getElementById("saveResponse").onclick=async ()=>{
  const db=load(), id=document.getElementById("respSelect").value;
  const g=db.gripes.find(x=>x.id===id); if(!g) return alert("Pick a gripe first!");
  const imgs=await Promise.all([...rFiles.files].slice(0,3).map(dt));
  g.gripee.images=imgs; g.gripee.text=clip(rText.value);
  save(db); go("#/");
};
function fillRespondSelect(){
  const db=load();
  respSelect.innerHTML=db.gripes.map(g=>`<option value="${g.id}">${g.id}</option>`).join("")||"<option>No gripes</option>";
}

/* ===== VOTING / DISPLAY ===== */
function img(el,data,alt){ if(!data){el.textContent=alt;el.style.backgroundImage="";return;} el.textContent="";el.style.background=`url(${data}) center/cover`; }

function renderHome(){
  const db=load();
  const sel=document.getElementById("homeSelect");
  sel.innerHTML=db.gripes.map(g=>`<option value="${g.id}" ${g.id===db.selectedId?"selected":""}>${g.id}</option>`).join("")||"<option>No gripes yet</option>";
  sel.onchange=()=>{db.selectedId=sel.value;save(db);paint();};

  const L={Circle:homeLeftCircle,Main:homeLeftMain,T2:homeLeftT2,T3:homeLeftT3,Text:homeLeftText};
  const R={Circle:homeRightCircle,Main:homeRightMain,T2:homeRightT2,T3:homeRightT3,Text:homeRightText};

  homeLeftText.readOnly=true; homeRightText.readOnly=true;

  function paint(){
    const g=db.gripes.find(x=>x.id===db.selectedId);
    if(!g)return;

    img(L.Circle,g.griper.images[0],"PHOTO");
    img(L.Main,g.griper.images[0],"Main");
    img(L.T2,g.griper.images[1],"Photo 2");
    img(L.T3,g.griper.images[2],"Photo 3");
    L.Text.value=g.griper.text||"";

    img(R.Circle,g.gripee.images[0],"PHOTO");
    img(R.Main,g.gripee.images[0],"Main");
    img(R.T2,g.gripee.images[1],"Photo 2");
    img(R.T3,g.gripee.images[2],"Photo 3");
    R.Text.value=g.gripee.text||"";

    countL.textContent=g.votes.L; countR.textContent=g.votes.R;

    starsL.innerHTML=""; starsR.innerHTML="";
    for(let s=1;s<=5;s++){
      const mk=(id,s)=>(()=>{
        localStorage.setItem("stars_"+id,s);
        paint();
      });
      const bL=document.createElement("button");
      const bR=document.createElement("button");
      bL.textContent=s+"★"; bR.textContent=s+"★";
      if(Number(localStorage.getItem("stars_L"))===s) bL.style.background="#2f3a85";
      if(Number(localStorage.getItem("stars_R"))===s) bR.style.background="#2f3a85";
      bL.onclick=mk("L",s); bR.onclick=mk("R",s);
      starsL.appendChild(bL); starsR.appendChild(bR);
    }

    voteL.onclick=()=>vote(g.id,"L");
    voteR.onclick=()=>vote(g.id,"R");
  }
  paint();

  function vote(id,side){
    const g=db.gripes.find(x=>x.id===id);
    if(!g)return;
    if(g.voted[browserId])return alert("Already voted!");
    g.voted[browserId]=true;
    g.votes[side]++;
    save(db); renderHome();
  }
}

/* ===== LIST ===== */
function renderList(){
  const db=load();
  gripesList.innerHTML="";
  db.gripes.forEach(g=>{
    const age=Math.floor((Date.now()-g.created)/(1000*60*60*24));
    const li=document.createElement("li");
    li.className=`card ${age<=3?"age-green":age<=5?"age-yellow":"age-red"}`;
    li.innerHTML=`
      <div style="display:flex;justify-content:space-between;">
        <div><strong>${g.id}</strong><br>${age} day(s)</div>
        <button class="btn secondary" onclick="(load().selectedId='${g.id}',save(load()),go('#/'))">Show</button>
      </div>`;
    gripesList.appendChild(li);
  });
}

/* ===== INIT ===== */
show((location.hash.replace("#/","")||"home"));
if(location.hash==="#/"||!location.hash)renderHome();
</script>
</body>
</html>
