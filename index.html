<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gripetime Head‑to‑Head (Stage 1)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap">
<style>
  :root{--purple:#6b4eff;--dark:#171233;--light:#f7f7ff;--edge:#e9e9f6;--green:#18a558;--yellow:#f1c40f;--red:#e74c3c}
  body{margin:0;background:#f5f6fb;color:#111;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .card{background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.06);padding:16px;margin:12px 0}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:760px){.grid{grid-template-columns:1fr}}
  .h2{font-weight:800;margin:0 0 10px}
  .label{font-weight:600;margin:10px 0 6px;display:block}
  .input,.text{width:100%;padding:10px 12px;border:1px solid var(--edge);border-radius:10px;font-size:15px}
  .btn{background:var(--purple);color:#fff;border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  .btn.secondary{background:#eee;color:#111}
  .dim{opacity:.75;font-size:13px}
  .main{width:100%;aspect-ratio:16/10;background:var(--light);border:2px dashed #cfcaf7;border-radius:14px;display:flex;align-items:center;justify-content:center;color:var(--purple);font-weight:800}
  .main img{width:100%;height:100%;object-fit:cover;border-radius:12px}
  .thumbs{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .thumbs img{width:100px;height:72px;object-fit:cover;border-radius:10px;border:2px solid transparent;cursor:pointer}
  .thumbs img.sel{border-color:var(--purple)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .bar{display:flex;align-items:center;justify-content:center;gap:12px;margin:8px 0 0}
  .vs{font-weight:800;color:var(--purple)}
  .list-title{display:flex;justify-content:space-between;align-items:center}
  .badge{padding:4px 10px;border-radius:999px;font-size:12px;background:#eee}
  .badge.green{background:var(--green);color:#fff}
  .badge.yellow{background:var(--yellow);color:#000}
  .badge.red{background:var(--red);color:#fff}
  .item{padding:12px;border:1px solid var(--edge);border-radius:12px;margin-top:10px;background:#fff}
  .link{color:var(--purple);text-decoration:none;font-weight:700;cursor:pointer}
  .spacer{height:6px}
  .title{font-weight:800;font-size:18px}
</style>
</head>
<body>
<img src="gripetime-logo.png" alt="Gripetime Logo" style="height:80px;">
  <div style="text-align:center; margin:20px 0;">
</div>
  <div class="wrap">
    <div class="card">
      <div class="bar">
        <span class="dim">Head‑to‑Head</span>
        <span class="vs">GRIPER</span><span class="dim">vs</span><span class="vs">GRIPEE</span>
        <span class="dim">• Upload up to 3 photos per side • Max 1000 lines of text</span>
      </div>
    </div>

    <div class="card">
      <div class="grid">
        <!-- Griper panel -->
        <div>
          <div class="h2">Griper</div>
          <div id="left_main" class="main">Upload up to 3 photos</div>
          <div class="thumbs" id="left_thumbs"></div>

          <label class="label">Photos (max 3)</label>
          <input id="left_files" type="file" accept="image/*" multiple class="input">

          <label class="label">Griper Text (up to 1000 lines)</label>
          <textarea id="left_text" class="text" rows="10" placeholder="Paste or type. Each newline counts as 1 line."></textarea>
          <div class="dim" id="left_count">0 / 1000 lines</div>
        </div>

        <!-- Gripee panel -->
        <div>
          <div class="h2">Gripee</div>
          <div id="right_main" class="main">Upload up to 3 photos</div>
          <div class="thumbs" id="right_thumbs"></div>

          <label class="label">Photos (max 3)</label>
          <input id="right_files" type="file" accept="image/*" multiple class="input">

          <label class="label">Gripee Text (up to 1000 lines)</label>
          <textarea id="right_text" class="text" rows="10"></textarea>
          <div class="dim" id="right_count">0 / 1000 lines</div>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <input id="h2h_title" class="input" placeholder="Optional title for this Head‑to‑Head" />
        <button class="btn" id="save_btn">Save locally</button>
        <button class="btn secondary" id="clear_btn">Clear</button>
        <div class="dim">Beginner mode: saves to your browser only (no server required).</div>
      </div>
    </div>

    <!-- Saved list -->
    <div class="card">
      <div class="list-title">
        <div class="title">Saved Head‑to‑Heads (local)</div>
        <div class="dim">Green 1–3d • Yellow 4–5d • Red >5d</div>
      </div>
      <div id="saved_list"></div>
    </div>

    <!-- Read view -->
    <div class="card" id="read_view" style="display:none"></div>
  </div>

<script>
(function(){
  const MAX_FILES = 3;
  const MAX_LINES = 1000;
  const el = (id)=>document.getElementById(id);
  const fmt = (ts)=> new Date(ts).toLocaleString();

  const ageBadge = (ts)=>{
    const days = Math.floor((Date.now()-ts)/86400000);
    const cls = days<=3 ? 'green' : days<=5 ? 'yellow' : 'red';
    return `<span class="badge ${cls}">${days}d</span>`;
  };

  const lineCount = (v)=> v ? v.split('\\n').length : 0;

  const updateCount = (which)=>{
    const txt = el(which+'_text').value;
    const count = Math.min(lineCount(txt), MAX_LINES);
    el(which+'_count').textContent = count + ' / ' + MAX_LINES + ' lines';
  };

  function handleFiles(which, files){
    const arr = Array.from(files).slice(0, MAX_FILES);
    if(files.length > MAX_FILES) alert('Only 3 images allowed. Extra files ignored.');
    const thumbs = el(which+'_thumbs');
    thumbs.innerHTML = '';
    const main = el(which+'_main');
    main.innerHTML = '<div class="dim">Preparing preview…</div>';
    arr.forEach((f,idx)=>{
      const r = new FileReader();
      r.onload = (e)=>{
        const url = e.target.result;
        const img = new Image();
        img.src = url;
        img.onclick = ()=> selectMain(which, url, img);
        if(idx === 0) selectMain(which, url);
        thumbs.appendChild(img);
        if(idx === 0) img.classList.add('sel');
      };
      r.readAsDataURL(f);
    });
  }

  function selectMain(which, url, thumbEl){
    const main = el(which+'_main');
    main.innerHTML = '';
    const big = new Image();
    big.src = url;
    main.appendChild(big);
    const thumbs = el(which+'_thumbs').querySelectorAll('img');
    thumbs.forEach(t=>t.classList.remove('sel'));
    if(thumbEl) thumbEl.classList.add('sel');
  }

  function saveLocal(){
    const leftImgs = Array.from(el('left_thumbs').querySelectorAll('img')).map(i=>i.src).slice(0,3);
    const rightImgs = Array.from(el('right_thumbs').querySelectorAll('img')).map(i=>i.src).slice(0,3);
    const data = {
      id: 'h2h'+Date.now(),
      title: el('h2h_title').value.trim(),
      left: {
        main: el('left_main').querySelector('img')?.src || null,
        imgs: leftImgs,
        text: el('left_text').value.split('\\n').slice(0,MAX_LINES).join('\\n')
      },
      right: {
        main: el('right_main').querySelector('img')?.src || null,
        imgs: rightImgs,
        text: el('right_text').value.split('\\n').slice(0,MAX_LINES).join('\\n')
      },
      createdAt: Date.now(),
      status: 'Active'
    };
    const list = JSON.parse(localStorage.getItem('gt_h2h_stage1')||'[]');
    list.unshift(data);
    localStorage.setItem('gt_h2h_stage1', JSON.stringify(list));
    alert('Saved locally! See it below in the Saved list.');
    renderList();
    clearInputs();
  }

  function clearInputs(){
    ['left','right'].forEach(which=>{
      el(which+'_files').value = '';
      el(which+'_thumbs').innerHTML = '';
      el(which+'_main').innerHTML = 'Upload up to 3 photos';
      el(which+'_text').value = '';
      updateCount(which);
    });
    el('h2h_title').value = '';
  }

  function renderList(){
    const box = el('saved_list');
    const list = JSON.parse(localStorage.getItem('gt_h2h_stage1')||'[]');
    if(list.length===0){ box.innerHTML = '<div class="dim">No items yet.</div>'; return; }
    box.innerHTML = list.map(item=>`
      <div class="item">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="title">${item.title || '(Untitled)'}</div>
          <div>${ageBadge(item.createdAt)} <span class="badge">${item.status}</span></div>
        </div>
        <div class="spacer"></div>
        <div class="dim">Saved ${fmt(item.createdAt)}</div>
        <div class="spacer"></div>
        <a class="link" onclick="GT_read('${item.id}')">Read</a>
      </div>
    `).join('');
  }

  function readView(id){
    const list = JSON.parse(localStorage.getItem('gt_h2h_stage1')||'[]');
    const item = list.find(x=>x.id===id);
    const panel = (title, main, text)=>`
      <div class="card">
        <div class="h2">${title}</div>
        <div class="main">${main ? '<img src="'+main+'" />' : 'No photo'}</div>
        <div class="spacer"></div>
        <pre style="white-space:pre-wrap">${(text||'').trim()}</pre>
      </div>`;
    el('read_view').style.display = 'block';
    el('read_view').innerHTML = `
      <div class="h2">${item.title || '(Untitled)'} — <span class="dim">${new Date(item.createdAt).toLocaleString()}</span></div>
      <div class="grid">
        ${panel('Griper', item.left.main, item.left.text)}
        ${panel('Gripee', item.right.main, item.right.text)}
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn secondary" onclick="GT_back()">Back</button>
      </div>
    `;
    window.scrollTo({top:0, behavior:'smooth'});
  }

  // Expose small helpers on window for inline onclick
  window.GT_read = readView;
  window.GT_back = ()=>{ el('read_view').style.display='none'; };

  // Bind events
  el('left_files').addEventListener('change', (e)=>handleFiles('left', e.target.files));
  el('right_files').addEventListener('change', (e)=>handleFiles('right', e.target.files));
  el('left_text').addEventListener('input', ()=>updateCount('left'));
  el('right_text').addEventListener('input', ()=>updateCount('right'));
  el('save_btn').addEventListener('click', saveLocal);
  el('clear_btn').addEventListener('click', clearInputs);

  updateCount('left'); updateCount('right');
  renderList();
})();
</script>
</body>
</html>
